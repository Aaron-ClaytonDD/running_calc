"use strict";(self.webpackChunkrunningcalc=self.webpackChunkrunningcalc||[]).push([[12],{7688:(n,e,t)=>{t.r(e),t.d(e,{DEFAULT_RUM_PROFILER_CONFIGURATION:()=>m,createRumProfiler:()=>v});var i=t(4879),s=t(7375),r=t(1729),o=t(9329),a=t(1770),c=t(8143);const l=new Map;let u=!1;function f(n){let{rawRumEvent:e,startTime:t}=n;if("long_task"!==e.type)return;!function(n,e){l.set(e,n)}(e.long_task.id,t)}var p=t(9867);const d={sendProfile:(n,e,t,i)=>{const s=function(n,e,t,i){const s=e.tags,r=function(n,e,t){const i={application:{id:e}};t&&(i.session={id:t});const s=Array.from(new Set(n.views.map((n=>n.viewId))));s.length&&(i.view={ids:s});const r=n.longTasks.map((n=>function(n){if(!(!1===u||n.startTime<u))return l.get(n.startTime)}(n))).filter((n=>void 0!==n));r.length&&(i.long_task={id:r});return i}(n,t,i),o=function(n){const e=n.concat(["language:javascript","runtime:chrome","family:chrome","format:json","host:browser"]);return e}(s),a=new Date(n.timeOrigin+n.startTime),c=new Date(n.timeOrigin+n.endTime);return{...r,attachments:["wall-time.json"],start:a.toISOString(),end:c.toISOString(),family:"chrome",tags_profiler:o.join(",")}}(n,e,t,i),r=function(n,e){const t=new Blob([JSON.stringify(n)],{type:"application/json"}),i=new FormData;return i.append("event",new Blob([JSON.stringify(e)],{type:"application/json"}),"event.json"),i.append("wall-time.json",t,"wall-time.json"),{data:i,bytesCount:0}}(n,s),o=e.build("fetch",r);return(0,p.A2)("Sending profile to public profiling intake",{profilingIntakeURL:o,applicationId:t,sessionId:i}),fetch(o,{body:r.data,method:"POST"})}},m={sampleIntervalMs:10,collectIntervalMs:6e4,minProfileDurationMs:5e3,minNumberOfSamples:50};function v(n,e,t){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;const v=(0,c.s5)(c.do.LONG_ANIMATION_FRAME);let g={state:"stopped"};function w(t){if("running"===t.state)return{cleanupTasks:t.cleanupTasks,observer:t.observer};const s=[];let r;if(n.trackLongTasks){r=new PerformanceObserver(y),r.observe({entryTypes:[v?"long-animation-frame":"longtask"]});const n=e.subscribe(12,(n=>{f(n)}));u=performance.now(),s.push((()=>null===r||void 0===r?void 0:r.disconnect())),s.push(n.unsubscribe)}s.push((0,i.q)(n,window,"visibilitychange",O).stop,(0,i.q)(n,window,"beforeunload",S).stop);const o=e.subscribe(2,(n=>{k(n.id)}));return s.push(o.unsubscribe),{cleanupTasks:s,observer:r}}function b(){const n=(0,s.V)().Profiler;if(!n)throw new Error("RUM Profiler is not supported in this browser.");h().catch(r.Dx);const{cleanupTasks:e,observer:t}=w(g);let i;try{i=new n({sampleInterval:p.sampleIntervalMs,maxBufferSize:Math.round(1.5*p.collectIntervalMs/p.sampleIntervalMs)})}catch(c){return void o.Vy.warn("[DD_RUM] Profiler startup failed. Ensure your server includes the `Document-Policy: js-profiling` response header when serving HTML pages.",c)}g={state:"running",startTime:performance.now(),profiler:i,timeoutId:(0,a.wg)(b,p.collectIntervalMs),longTasks:[],views:[],cleanupTasks:e,observer:t},i.addEventListener("samplebufferfull",I)}async function h(){var e,i;if("running"!==g.state)return;M(null!==(i=null===(e=g.observer)||void 0===e?void 0:e.takeRecords())&&void 0!==i?i:[]),(0,a.DJ)(g.timeoutId),g.profiler.removeEventListener("samplebufferfull",I);const{startTime:s,longTasks:o,views:c}=g,f=performance.now();await g.profiler.stop().then((e=>{const i=performance.now();i-s<p.minProfileDurationMs||function(n){let e=0;for(const t of n)void 0!==t.stackId&&e++;return e}(e.samples)<p.minNumberOfSamples||(function(e){var i;const s=null===(i=t.findTrackedSession())||void 0===i?void 0:i.id;d.sendProfile(e,n.profilingEndpointBuilder,n.applicationId,s).catch(r.Dx)}(Object.assign(e,{startTime:s,endTime:i,timeOrigin:performance.timeOrigin,longTasks:o,views:c,sampleInterval:p.sampleIntervalMs})),function(n){if(!(!1===u||n<u))for(const e of l.keys())e<n&&l.delete(e)}(f))})).catch(r.Dx)}async function T(n){"running"===g.state&&(g.cleanupTasks.forEach((n=>n())),await h(),g={state:n})}function k(n){"running"===g.state&&g.views.push({startTime:performance.now(),viewId:n||""})}function I(){b()}function y(n){M(n.getEntries())}function M(n){if("running"===g.state)for(const e of n)e.duration<p.sampleIntervalMs||g.longTasks.push(e)}function O(){"hidden"===document.visibilityState&&"running"===g.state?T("paused").catch(r.Dx):"visible"===document.visibilityState&&"paused"===g.state&&b()}function S(){b()}return{start:function(n){"running"!==g.state&&(k(n),b())},stop:async function(){await T("stopped"),u=!1,l.clear()},isStopped:function(){return"stopped"===g.state},isStarted:function(){return"running"===g.state}}}}}]);
//# sourceMappingURL=profiler.743b402a.chunk.js.map